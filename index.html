<div class="top-nav">
        <div class="nav-logo">EatHaven</div>
        <div style="display: flex; align-items: center; gap: 12px;">
            <div class="mottainai-badge" style="background: #10b981; color: white; padding: 4px 12px; border-radius: 20px; font-weight: 800; font-size: 14px;">
                üèØ <span id="mottainaiScore">0</span>
            </div>
            <button class="hamburger" onclick="openProfileModal()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>

    <script>
        // Erweitere dein userProfile Objekt
        var userProfile = {
            name: '',
            adults: 2,
            children: 0,
            diet: 'flexitarian',
            allergies: [],
            supermarket: 'rewe',
            monthlyBudget: 200,
            spent: 0,
            mottainaiScore: 0 // Neu hinzugef√ºgt
        };

        // Die neue, reparierte Upload-Funktion
        async function handlePhotoUpload(event) {
            var file = event.target.files[0];
            if (!file) return;

            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('recipesSection').classList.add('hidden');

            var reader = new FileReader();
            reader.onload = async function(e) {
                // Sende nur den reinen Base64 String ohne Header
                var base64Image = e.target.result.replace(/^data:image\/\w+;base64,/, "");

                try {
                    var response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            image: base64Image,
                            budget: userProfile.monthlyBudget,
                            people: userProfile.adults + userProfile.children,
                            diet: userProfile.diet
                        })
                    });

                    var data = await response.json();
                    
                    // MOTTAINAI LOGIK: Punkte vergeben
                    if (data.items) {
                        let points = data.items.reduce((acc, item) => acc + (item.urgency * 10), 0);
                        userProfile.mottainaiScore += points;
                        document.getElementById('mottainaiScore').textContent = userProfile.mottainaiScore;
                        document.getElementById('ingredientCount').textContent = data.items.length;
                        
                        // Rang-Update
                        let rank = "Lehrling";
                        if(userProfile.mottainaiScore > 500) rank = "Profi";
                        if(userProfile.mottainaiScore > 1000) rank = "Meister üèØ";
                        document.getElementById('flowTitle').textContent = rank;
                    }

                    renderRecipes(data.recipes);
                    document.getElementById('loadingSection').classList.add('hidden');
                    document.getElementById('recipesSection').classList.remove('hidden');

                } catch (error) {
                    console.error('Fehler:', error);
                    document.getElementById('loadingSection').classList.add('hidden');
                    alert('KI-Fehler: Bitte pr√ºfe die Vercel-Logs!');
                }
            };
            reader.readAsDataURL(file);
        }
    </script>
