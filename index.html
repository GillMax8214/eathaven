<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EatHaven - Your Safe Place to Eat</title>
    <style>
        /* Dein Original-Design */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 20px; padding-bottom: 60px; }
        .container { max-width: 800px; margin: 60px auto 0; }
        .top-nav { position: fixed; top: 0; left: 0; right: 0; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); padding: 12px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 999; display: flex; justify-content: space-between; align-items: center; }
        .nav-logo { font-size: 24px; font-weight: 900; background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hamburger { width: 40px; height: 40px; background: none; border: none; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 5px; }
        .hamburger span { display: block; width: 24px; height: 3px; background: #10b981; border-radius: 2px; }
        .card { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 24px; margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .btn { width: 100%; padding: 20px; border: none; border-radius: 16px; font-size: 18px; font-weight: 800; cursor: pointer; transition: all 0.3s; margin: 12px 0; }
        .btn-camera { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; display: flex; align-items: center; justify-content: center; gap: 12px; }
        .hidden { display: none; }
        /* Modal Styles */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; padding: 20px; }
        .modal.active { display: block; }
        .modal-content { background: white; border-radius: 24px; max-width: 600px; margin: 40px auto; padding: 24px; }
    </style>
</head>
<body>
    <div class="top-nav">
        <div class="nav-logo">EatHaven</div>
        <div style="display: flex; align-items: center; gap: 12px;">
            <div id="mottainaiDisplay" style="background: #10b981; color: white; padding: 4px 12px; border-radius: 20px; font-weight: 800;">üèØ 0</div>
            <button class="hamburger" onclick="openProfileModal()">
                <span></span><span></span><span></span>
            </button>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <h1 style="text-align: center; color: #10b981;">EatHaven</h1>
            <p id="greetingText" style="text-align: center; font-weight: 700;">Willkommen!</p>
            
            <div id="dashboard" style="margin-top: 20px; background: #ecfdf5; padding: 15px; border-radius: 15px; border: 2px solid #10b981;">
                <div style="display: flex; justify-content: space-around; text-align: center;">
                    <div><div id="ingredientCount" style="font-size: 24px; font-weight: 900;">0</div><div style="font-size: 10px;">ITEMS</div></div>
                    <div><div id="daysLeft" style="font-size: 24px; font-weight: 900;">?</div><div style="font-size: 10px;">TAGE</div></div>
                    <div><div id="budgetLeft" style="font-size: 24px; font-weight: 900;">200‚Ç¨</div><div style="font-size: 10px;">BUDGET</div></div>
                </div>
            </div>
        </div>

        <input type="file" id="photoInput" accept="image/*" capture="environment" class="hidden" onchange="handlePhotoUpload(event)">
        <button class="btn btn-camera" onclick="document.getElementById('photoInput').click()">
            üì∏ K√ºhlschrank scannen
        </button>

        <div id="loadingSection" class="card hidden">
            <p style="text-align: center;">üß† KI analysiert dein Bild...</p>
        </div>

        <div id="recipesSection" class="hidden">
            <div id="recipeContainer"></div>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content">
            <h2>‚ú® Dein Profil</h2>
            <div style="margin: 20px 0;">
                <label>Budget: <span id="budgetValue">200</span>‚Ç¨</label>
                <input type="range" min="20" max="400" value="200" style="width: 100%;" oninput="updateBudget(this.value)">
            </div>
            <button class="btn" style="background: #10b981; color: white;" onclick="closeProfileModal()">Speichern</button>
        </div>
    </div>

    <script>
        var userProfile = { mottainaiScore: 0, monthlyBudget: 200, spent: 0, diet: 'flexitarian' };

        function openProfileModal() { document.getElementById('profileModal').classList.add('active'); }
        function closeProfileModal() { document.getElementById('profileModal').classList.remove('active'); }
        
        function updateBudget(val) {
            document.getElementById('budgetValue').textContent = val;
            userProfile.monthlyBudget = val;
            document.getElementById('budgetLeft').textContent = val + '‚Ç¨';
        }

        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            document.getElementById('loadingSection').classList.remove('hidden');

            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64Image = e.target.result.replace(/^data:image\/\w+;base64,/, "");
                try {
                    const res = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ image: base64Image, diet: userProfile.diet, budget: userProfile.monthlyBudget, people: 2 })
                    });
                    const data = await res.json();
                    
                    if(data.items) {
                        userProfile.mottainaiScore += (data.items.length * 10);
                        document.getElementById('mottainaiDisplay').textContent = "üèØ " + userProfile.mottainaiScore;
                        document.getElementById('ingredientCount').textContent = data.items.length;
                        document.getElementById('daysLeft').textContent = data.daysEstimate;
                    }
                    document.getElementById('loadingSection').classList.add('hidden');
                } catch (err) {
                    alert("API Fehler!");
                    document.getElementById('loadingSection').classList.add('hidden');
                }
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
